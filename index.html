<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Hampa Juice - Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù…</title>

  <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2c7a7b">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <!-- Ù…ÙƒØªØ¨Ø© Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('service-worker.js')
          .then(function(registration) {
            console.log('ServiceWorker registered:', registration);
          })
          .catch(function(error) {
            console.log('ServiceWorker registration failed:', error);
          });
      });
    }
  </script>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(to bottom right, #f0f8ff, #e0ffe0);
      text-align: center;
      padding: 30px;
      color: #333;
    }
    h1 {
      font-size: 36px;
      color: #2c7a7b;
      margin-bottom: 5px;
    }
    h2 {
      font-size: 24px;
      color: #444;
      margin-bottom: 30px;
    }
    .employee {
      background: #ffffff;
      border: 2px solid #2c7a7b;
      border-radius: 10px;
      padding: 15px;
      margin: 10px;
      display: inline-block;
      width: 320px;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
    }
    button {
      background-color: #2c7a7b;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      margin: 5px;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background-color: #226666;
    }
    #log {
      margin-top: 30px;
      white-space: pre-wrap;
      text-align: right;
      direction: rtl;
      max-width: 600px;
      margin-inline: auto;
      border-top: 1px solid #aaa;
      padding-top: 10px;
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <h1>Hampa Juice</h1>
  <h2>Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù…</h2>

  <div id="employees">
    <div class="employee">
      <strong>Ù…Ø­Ù…Ø¯ Ø´Ø¹Ø¨Ø§Ù†<br>ÙˆÙŠØªØ± - Ù…ØµØ±ÙŠ</strong><br>
      <button onclick="logTime('Ù…Ø­Ù…Ø¯ Ø´Ø¹Ø¨Ø§Ù†', 'Ø¯Ø®ÙˆÙ„')">Ø¯Ø®ÙˆÙ„</button>
      <button onclick="logTime('Ù…Ø­Ù…Ø¯ Ø´Ø¹Ø¨Ø§Ù†', 'Ø®Ø±ÙˆØ¬')">Ø®Ø±ÙˆØ¬</button>
      <button onclick="downloadReport('Ù…Ø­Ù…Ø¯ Ø´Ø¹Ø¨Ø§Ù†')">ğŸ“„ ØªÙ‚Ø±ÙŠØ±</button>
    </div>

    <div class="employee">
      <strong>Ù…Ø¹Ø±ÙˆÙˆÙ Ø®Ø§Ù†<br>ØµØ§Ù†Ø¹ Ø¹ØµÙŠØ± - ÙƒØ´Ù…ÙŠØ±ÙŠ</strong><br>
      <button onclick="logTime('Ù…Ø¹Ø±ÙˆÙˆÙ Ø®Ø§Ù†', 'Ø¯Ø®ÙˆÙ„')">Ø¯Ø®ÙˆÙ„</button>
      <button onclick="logTime('Ù…Ø¹Ø±ÙˆÙˆÙ Ø®Ø§Ù†', 'Ø®Ø±ÙˆØ¬')">Ø®Ø±ÙˆØ¬</button>
      <button onclick="downloadReport('Ù…Ø¹Ø±ÙˆÙˆÙ Ø®Ø§Ù†')">ğŸ“„ ØªÙ‚Ø±ÙŠØ±</button>
    </div>
  </div>

  <button onclick="downloadExcel()">ğŸ“¥ Ø­ÙØ¸ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„ ÙƒÙ€ Excel</button>

  <div id="log"></div>

  <script>
    let logData = [];

    function logTime(name, action) {
      const now = new Date();
      const date = now.toLocaleDateString("ar-EG");
      const time = now.toLocaleTimeString("ar-EG");
      logData.push({ Ø§Ù„Ù…ÙˆØ¸Ù: name, ØªØ§Ø±ÙŠØ®: date, Ø¯Ø®ÙˆÙ„: action === "Ø¯Ø®ÙˆÙ„" ? time : "", Ø®Ø±ÙˆØ¬: action === "Ø®Ø±ÙˆØ¬" ? time : "" });

      document.getElementById("log").textContent += `${action} - ${name} - ${date} ${time}\n`;
    }

    function downloadReport(name) {
      const entries = logData.filter(e => e.Ø§Ù„Ù…ÙˆØ¸Ù === name);
      if (entries.length === 0) {
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ø¹Ø¯.");
        return;
      }

      let content = `ğŸ“‹ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ¸Ù: ${name}\n\n`;
      entries.forEach(e => {
        content += `ğŸ“… ${e.ØªØ§Ø±ÙŠØ®} | Ø¯Ø®ÙˆÙ„: ${e.Ø¯Ø®ÙˆÙ„ || "-"} | Ø®Ø±ÙˆØ¬: ${e.Ø®Ø±ÙˆØ¬ || "-"}\n`;
      });

      const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `ØªÙ‚Ø±ÙŠØ±_${name.replace(/ /g, "_")}.txt`;
      link.click();
    }

    function downloadExcel() {
      const merged = {};
      logData.forEach(row => {
        const key = row.Ø§Ù„Ù…ÙˆØ¸Ù + "_" + row.ØªØ§Ø±ÙŠØ®;
        if (!merged[key]) merged[key] = { Ø§Ù„Ù…ÙˆØ¸Ù: row.Ø§Ù„Ù…ÙˆØ¸Ù, ØªØ§Ø±ÙŠØ®: row.ØªØ§Ø±ÙŠØ®, Ø¯Ø®ÙˆÙ„: "", Ø®Ø±ÙˆØ¬: "" };
        if (row.Ø¯Ø®ÙˆÙ„) merged[key].Ø¯Ø®ÙˆÙ„ = row.Ø¯Ø®ÙˆÙ„;
        if (row.Ø®Ø±ÙˆØ¬) merged[key].Ø®Ø±ÙˆØ¬ = row.Ø®Ø±ÙˆØ¬;
      });

      const finalData = Object.values(merged);
      const worksheet = XLSX.utils.json_to_sheet(finalData);
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, "Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙˆØ§Ù…");
      XLSX.writeFile(workbook, "Ø³Ø¬Ù„_Ø§Ù„Ø¯ÙˆØ§Ù…_Ø§Ù„ÙƒØ§Ù…Ù„.xlsx");
    }
  </script>
</body>
</html>
